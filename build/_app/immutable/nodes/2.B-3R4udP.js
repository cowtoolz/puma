import{f as le,a as Y,t as tr,c as sr}from"../chunks/DJtALwwB.js";import{b as rr,h as j,i as nr,A as M,G as ar,r as ir,j as or,k as Pt,m as At,o as st,f as ue,af as cr,p as cs,d as ls,q as lr,ap as rt,aj as us,W as Tt,aq as ur,z as hr,ar as It,as as dr,at as fr,ai as gr,au as mr,e as pr,av as _r,aw as yr,ad as wr,ab as br,ax as Sr,ay as vr,az as kr,aA as Mr,aB as xr,aC as Rr,a as Er,v as Pr,a2 as hs,am as ee,a5 as H,a7 as te,B as L,a6 as X,a3 as Me,a4 as ds,g as nt,ao as Nt,aD as Ar}from"../chunks/D0h6Els1.js";import{a as Tr,l as Ir,d as Nr,e as He,s as fs}from"../chunks/BKfW1ueh.js";import{p as ke,b as $r,i as Xe,s as Or,a as $t}from"../chunks/B23u6coj.js";import{w as gs}from"../chunks/wIIAc-jw.js";function Ot(r,e){return e}function Lr(r,e,t,s){for(var n=[],a=e.length,i=0;i<a;i++)fr(e[i].e,n,!0);var o=a>0&&n.length===0&&t!==null;if(o){var l=t.parentNode;gr(l),l.append(t),s.clear(),Q(r,e[0].prev,e[a-1].next)}mr(n,()=>{for(var f=0;f<a;f++){var u=e[f];o||(s.delete(u.k),Q(r,u.prev,u.next)),pr(u.e,!o)}})}function Lt(r,e,t,s,n,a=null){var i=r,o={flags:e,items:new Map,first:null};j&&nr();var l=null,f=!1,u=ar(()=>{var d=t();return br(d)?d:d==null?[]:us(d)});rr(()=>{var d=M(u),p=d.length;if(f&&p===0)return;f=p===0;let h=!1;if(j){var w=ir(i)===or;w!==(p===0)&&(i=Pt(),At(i),st(!1),h=!0)}if(j){for(var R=null,_,g=0;g<p;g++){if(ue.nodeType===8&&ue.data===cr){i=ue,h=!0,st(!1);break}var v=d[g],S=s(v,g);_=ms(ue,o,R,null,v,S,g,n,e,t),o.items.set(S,_),R=_}p>0&&At(Pt())}j||jr(d,o,i,n,e,s,t),a!==null&&(p===0?l?cs(l):l=ls(()=>a(i)):l!==null&&lr(l,()=>{l=null})),h&&st(!0),M(u)}),j&&(i=ue)}function jr(r,e,t,s,n,a,i){var o=r.length,l=e.items,f=e.first,u=f,d,p=null,h=[],w=[],R,_,g,v;for(v=0;v<o;v+=1){if(R=r[v],_=a(R,v),g=l.get(_),g===void 0){var S=u?u.e.nodes_start:t;p=ms(S,e,p,p===null?e.first:p.next,R,_,v,s,n,i),l.set(_,p),h=[],w=[],u=p.next;continue}if(qr(g,R,v),(g.e.f&rt)!==0&&cs(g.e),g!==u){if(d!==void 0&&d.has(g)){if(h.length<w.length){var k=w[0],A;p=k.prev;var G=h[0],D=h[h.length-1];for(A=0;A<h.length;A+=1)jt(h[A],k,t);for(A=0;A<w.length;A+=1)d.delete(w[A]);Q(e,G.prev,D.next),Q(e,p,G),Q(e,D,k),u=k,p=D,v-=1,h=[],w=[]}else d.delete(g),jt(g,u,t),Q(e,g.prev,g.next),Q(e,g,p===null?e.first:p.next),Q(e,p,g),p=g;continue}for(h=[],w=[];u!==null&&u.k!==_;)(u.e.f&rt)===0&&(d??(d=new Set)).add(u),w.push(u),u=u.next;if(u===null)continue;g=u}h.push(g),p=g,u=g.next}if(u!==null||d!==void 0){for(var z=d===void 0?[]:us(d);u!==null;)(u.e.f&rt)===0&&z.push(u),u=u.next;var F=z.length;if(F>0){var O=null;Lr(e,z,O,l)}}Tt.first=e.first&&e.first.e,Tt.last=p&&p.e}function qr(r,e,t,s){ur(r.v,e),r.i=t}function ms(r,e,t,s,n,a,i,o,l,f){var u=(l&_r)!==0,d=(l&yr)===0,p=u?d?hr(n):It(n):n,h=(l&dr)===0?i:It(i),w={i:h,v:p,k:a,a:null,e:null,prev:t,next:s};try{return w.e=ls(()=>o(r,p,h,f),j),w.e.prev=t&&t.e,w.e.next=s&&s.e,t===null?e.first=w:(t.next=w,t.e.next=w.e),s!==null&&(s.prev=w,s.e.prev=w.e),w}finally{}}function jt(r,e,t){for(var s=r.next?r.next.e.nodes_start:t,n=e?e.e.nodes_start:t,a=r.e.nodes_start;a!==s;){var i=wr(a);n.before(a),a=i}}function Q(r,e,t){e===null?r.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}const qt=[...` 	
\r\fÂ \v\uFEFF`];function Br(r,e,t){var s=r==null?"":""+r;if(e&&(s=s?s+" "+e:e),t){for(var n in t)if(t[n])s=s?s+" "+n:n;else if(s.length)for(var a=n.length,i=0;(i=s.indexOf(n,i))>=0;){var o=i+a;(i===0||qt.includes(s[i-1]))&&(o===s.length||qt.includes(s[o]))?s=(i===0?"":s.substring(0,i))+s.substring(o+1):i=o}}return s===""?null:s}function ps(r,e,t,s,n,a){var i=r.__className;if(j||i!==t||i===void 0){var o=Br(t,s,a);(!j||o!==r.getAttribute("class"))&&(o==null?r.removeAttribute("class"):r.className=o),r.__className=t}else if(a&&n!==a)for(var l in a){var f=!!a[l];(n==null||f!==!!n[l])&&r.classList.toggle(l,f)}return a}const Ur=Symbol("is custom element"),Dr=Symbol("is html");function _s(r){if(j){var e=!1,t=()=>{if(!e){if(e=!0,r.hasAttribute("value")){var s=r.value;yt(r,"value",null),r.value=s}if(r.hasAttribute("checked")){var n=r.checked;yt(r,"checked",null),r.checked=n}}};r.__on_r=t,Sr(t),Tr()}}function yt(r,e,t,s){var n=Fr(r);j&&(n[e]=r.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&r.nodeName==="LINK")||n[e]!==(n[e]=t)&&(e==="loading"&&(r[Mr]=t),t==null?r.removeAttribute(e):typeof t!="string"&&Wr(r).includes(e)?r[e]=t:r.setAttribute(e,t))}function Fr(r){return r.__attributes??(r.__attributes={[Ur]:r.nodeName.includes("-"),[Dr]:r.namespaceURI===vr})}var Bt=new Map;function Wr(r){var e=Bt.get(r.nodeName);if(e)return e;Bt.set(r.nodeName,e=[]);for(var t,s=r,n=Element.prototype;n!==s;){t=xr(s);for(var a in t)t[a].set&&e.push(a);s=kr(s)}return e}function ys(r,e,t=e){var s=Rr();Ir(r,"input",n=>{var a=n?r.defaultValue:r.value;if(a=at(r)?it(a):a,t(a),s&&a!==(a=e())){var i=r.selectionStart,o=r.selectionEnd;r.value=a??"",o!==null&&(r.selectionStart=i,r.selectionEnd=Math.min(o,r.value.length))}}),(j&&r.defaultValue!==r.value||Er(e)==null&&r.value)&&t(at(r)?it(r.value):r.value),Pr(()=>{var n=e();at(r)&&n===it(r.value)||r.type==="date"&&!n&&!r.value||n!==r.value&&(r.value=n??"")})}function at(r){var e=r.type;return e==="number"||e==="range"}function it(r){return r===""?null:+r}const ws=gs([]),vt=gs([]),Cr='You are an AI model that allows users to have rich conversations with a persona crafted from an image and the objects and entities therein. From the moment you receive the image, you will assume the persona and speak only through the character you create in first-person. Take a somewhat realistic tone, but adapt to the conversation the user seems to desire. When a user provides context (directly or indirectly), integrate that into the persona and adapt your responses. You are not to "perform actions" (i.e. do not use asterisks, underscores, or brackets to describe actions). This is not textual role-playing, you are literally going to become whatever it is you see in the image. Your responses should be extremely concise, and remember that you are having a conversation with the user.';function m(r,e,t,s,n){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(r,t),t}function c(r,e,t,s){if(t==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?s:t==="a"?s.call(r):s?s.value:e.get(r)}let bs=function(){const{crypto:r}=globalThis;if(r!=null&&r.randomUUID)return bs=r.randomUUID.bind(r),r.randomUUID();const e=new Uint8Array(1),t=r?()=>r.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,s=>(+s^t()&15>>+s/4).toString(16))};function xe(r){return typeof r=="object"&&r!==null&&("name"in r&&r.name==="AbortError"||"message"in r&&String(r.message).includes("FetchRequestCanceledException"))}const wt=r=>{if(r instanceof Error)return r;if(typeof r=="object"&&r!==null){try{if(Object.prototype.toString.call(r)==="[object Error]"){const e=new Error(r.message,r.cause?{cause:r.cause}:{});return r.stack&&(e.stack=r.stack),r.cause&&!e.cause&&(e.cause=r.cause),r.name&&(e.name=r.name),e}}catch{}try{return new Error(JSON.stringify(r))}catch{}}return new Error(r)};class y extends Error{}class E extends y{constructor(e,t,s,n){super(`${E.makeMessage(e,t,s)}`),this.status=e,this.headers=n,this.requestID=n==null?void 0:n.get("request-id"),this.error=t}static makeMessage(e,t,s){const n=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):s;return e&&n?`${e} ${n}`:e?`${e} status code (no body)`:n||"(no status code or body)"}static generate(e,t,s,n){if(!e||!n)return new Ye({message:s,cause:wt(t)});const a=t;return e===400?new vs(e,a,s,n):e===401?new ks(e,a,s,n):e===403?new Ms(e,a,s,n):e===404?new xs(e,a,s,n):e===409?new Rs(e,a,s,n):e===422?new Es(e,a,s,n):e===429?new Ps(e,a,s,n):e>=500?new As(e,a,s,n):new E(e,a,s,n)}}class q extends E{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class Ye extends E{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class Ss extends Ye{constructor({message:e}={}){super({message:e??"Request timed out."})}}class vs extends E{}class ks extends E{}class Ms extends E{}class xs extends E{}class Rs extends E{}class Es extends E{}class Ps extends E{}class As extends E{}const Hr=/^[a-z][a-z0-9+.-]*:/i,Xr=r=>Hr.test(r);function Ut(r){return typeof r!="object"?{}:r??{}}function Jr(r){if(!r)return!0;for(const e in r)return!1;return!0}function zr(r,e){return Object.prototype.hasOwnProperty.call(r,e)}const Vr=(r,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new y(`${r} must be an integer`);if(e<0)throw new y(`${r} must be a positive integer`);return e},Ts=r=>{try{return JSON.parse(r)}catch{return}},Kr=r=>new Promise(e=>setTimeout(e,r)),Ve={off:0,error:200,warn:300,info:400,debug:500},Dt=(r,e,t)=>{if(r){if(zr(Ve,r))return r;P(t).warn(`${e} was set to ${JSON.stringify(r)}, expected one of ${JSON.stringify(Object.keys(Ve))}`)}};function Se(){}function Ae(r,e,t){return!e||Ve[r]>Ve[t]?Se:e[r].bind(e)}const Qr={error:Se,warn:Se,info:Se,debug:Se};let Ft=new WeakMap;function P(r){const e=r.logger,t=r.logLevel??"off";if(!e)return Qr;const s=Ft.get(e);if(s&&s[0]===t)return s[1];const n={error:Ae("error",e,t),warn:Ae("warn",e,t),info:Ae("info",e,t),debug:Ae("debug",e,t)};return Ft.set(e,[t,n]),n}const Z=r=>(r.options&&(r.options={...r.options},delete r.options.headers),r.headers&&(r.headers=Object.fromEntries((r.headers instanceof Headers?[...r.headers]:Object.entries(r.headers)).map(([e,t])=>[e,e.toLowerCase()==="x-api-key"||e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in r&&(r.retryOfRequestLogID&&(r.retryOf=r.retryOfRequestLogID),delete r.retryOfRequestLogID),r),ae="0.53.0",Yr=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function Gr(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const Zr=()=>{var t;const r=Gr();if(r==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ae,"X-Stainless-OS":Ct(Deno.build.os),"X-Stainless-Arch":Wt(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((t=Deno.version)==null?void 0:t.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ae,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(r==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ae,"X-Stainless-OS":Ct(globalThis.process.platform??"unknown"),"X-Stainless-Arch":Wt(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};const e=en();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ae,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ae,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function en(){if(typeof navigator>"u"||!navigator)return null;const r=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of r){const s=t.exec(navigator.userAgent);if(s){const n=s[1]||0,a=s[2]||0,i=s[3]||0;return{browser:e,version:`${n}.${a}.${i}`}}}return null}const Wt=r=>r==="x32"?"x32":r==="x86_64"||r==="x64"?"x64":r==="arm"?"arm":r==="aarch64"||r==="arm64"?"arm64":r?`other:${r}`:"unknown",Ct=r=>(r=r.toLowerCase(),r.includes("ios")?"iOS":r==="android"?"Android":r==="darwin"?"MacOS":r==="win32"?"Windows":r==="freebsd"?"FreeBSD":r==="openbsd"?"OpenBSD":r==="linux"?"Linux":r?`Other:${r}`:"Unknown");let Ht;const tn=()=>Ht??(Ht=Zr());function sn(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new Anthropic({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function Is(...r){const e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...r)}function Ns(r){let e=Symbol.asyncIterator in r?r[Symbol.asyncIterator]():r[Symbol.iterator]();return Is({start(){},async pull(t){const{done:s,value:n}=await e.next();s?t.close():t.enqueue(n)},async cancel(){var t;await((t=e.return)==null?void 0:t.call(e))}})}function kt(r){if(r[Symbol.asyncIterator])return r;const e=r.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function rn(r){var s,n;if(r===null||typeof r!="object")return;if(r[Symbol.asyncIterator]){await((n=(s=r[Symbol.asyncIterator]()).return)==null?void 0:n.call(s));return}const e=r.getReader(),t=e.cancel();e.releaseLock(),await t}const nn=({headers:r,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});function an(r){let e=0;for(const n of r)e+=n.length;const t=new Uint8Array(e);let s=0;for(const n of r)t.set(n,s),s+=n.length;return t}let Xt;function Mt(r){let e;return(Xt??(e=new globalThis.TextEncoder,Xt=e.encode.bind(e)))(r)}let Jt;function zt(r){let e;return(Jt??(e=new globalThis.TextDecoder,Jt=e.decode.bind(e)))(r)}var T,I;class Re{constructor(){T.set(this,void 0),I.set(this,void 0),m(this,T,new Uint8Array),m(this,I,null)}decode(e){if(e==null)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?Mt(e):e;m(this,T,an([c(this,T,"f"),t]));const s=[];let n;for(;(n=on(c(this,T,"f"),c(this,I,"f")))!=null;){if(n.carriage&&c(this,I,"f")==null){m(this,I,n.index);continue}if(c(this,I,"f")!=null&&(n.index!==c(this,I,"f")+1||n.carriage)){s.push(zt(c(this,T,"f").subarray(0,c(this,I,"f")-1))),m(this,T,c(this,T,"f").subarray(c(this,I,"f"))),m(this,I,null);continue}const a=c(this,I,"f")!==null?n.preceding-1:n.preceding,i=zt(c(this,T,"f").subarray(0,a));s.push(i),m(this,T,c(this,T,"f").subarray(n.index)),m(this,I,null)}return s}flush(){return c(this,T,"f").length?this.decode(`
`):[]}}T=new WeakMap,I=new WeakMap;Re.NEWLINE_CHARS=new Set([`
`,"\r"]);Re.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function on(r,e){for(let n=e??0;n<r.length;n++){if(r[n]===10)return{preceding:n,index:n+1,carriage:!1};if(r[n]===13)return{preceding:n,index:n+1,carriage:!0}}return null}function cn(r){for(let s=0;s<r.length-1;s++){if(r[s]===10&&r[s+1]===10||r[s]===13&&r[s+1]===13)return s+2;if(r[s]===13&&r[s+1]===10&&s+3<r.length&&r[s+2]===13&&r[s+3]===10)return s+4}return-1}class U{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let s=!1;async function*n(){if(s)throw new y("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let a=!1;try{for await(const i of ln(e,t)){if(i.event==="completion")try{yield JSON.parse(i.data)}catch(o){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),o}if(i.event==="message_start"||i.event==="message_delta"||i.event==="message_stop"||i.event==="content_block_start"||i.event==="content_block_delta"||i.event==="content_block_stop")try{yield JSON.parse(i.data)}catch(o){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),o}if(i.event!=="ping"&&i.event==="error")throw new E(void 0,Ts(i.data)??i.data,void 0,e.headers)}a=!0}catch(i){if(xe(i))return;throw i}finally{a||t.abort()}}return new U(n,t)}static fromReadableStream(e,t){let s=!1;async function*n(){const i=new Re,o=kt(e);for await(const l of o)for(const f of i.decode(l))yield f;for(const l of i.flush())yield l}async function*a(){if(s)throw new y("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let i=!1;try{for await(const o of n())i||o&&(yield JSON.parse(o));i=!0}catch(o){if(xe(o))return;throw o}finally{i||t.abort()}}return new U(a,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],s=this.iterator(),n=a=>({next:()=>{if(a.length===0){const i=s.next();e.push(i),t.push(i)}return a.shift()}});return[new U(()=>n(e),this.controller),new U(()=>n(t),this.controller)]}toReadableStream(){const e=this;let t;return Is({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{const{value:n,done:a}=await t.next();if(a)return s.close();const i=Mt(JSON.stringify(n)+`
`);s.enqueue(i)}catch(n){s.error(n)}},async cancel(){var s;await((s=t.return)==null?void 0:s.call(t))}})}}async function*ln(r,e){if(!r.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new y("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new y("Attempted to iterate over a response with no body");const t=new hn,s=new Re,n=kt(r.body);for await(const a of un(n))for(const i of s.decode(a)){const o=t.decode(i);o&&(yield o)}for(const a of s.flush()){const i=t.decode(a);i&&(yield i)}}async function*un(r){let e=new Uint8Array;for await(const t of r){if(t==null)continue;const s=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?Mt(t):t;let n=new Uint8Array(e.length+s.length);n.set(e),n.set(s,e.length),e=n;let a;for(;(a=cn(e))!==-1;)yield e.slice(0,a),e=e.slice(a)}e.length>0&&(yield e)}class hn{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const a={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,s,n]=dn(e,":");return n.startsWith(" ")&&(n=n.substring(1)),t==="event"?this.event=n:t==="data"&&this.data.push(n),null}}function dn(r,e){const t=r.indexOf(e);return t!==-1?[r.substring(0,t),e,r.substring(t+e.length)]:[r,"",""]}async function $s(r,e){const{response:t,requestLogID:s,retryOfRequestLogID:n,startTime:a}=e,i=await(async()=>{var d;if(e.options.stream)return P(r).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller):U.fromSSEResponse(t,e.controller);if(t.status===204)return null;if(e.options.__binaryResponse)return t;const o=t.headers.get("content-type"),l=(d=o==null?void 0:o.split(";")[0])==null?void 0:d.trim();if((l==null?void 0:l.includes("application/json"))||(l==null?void 0:l.endsWith("+json"))){const p=await t.json();return Os(p,t)}return await t.text()})();return P(r).debug(`[${s}] response parsed`,Z({retryOfRequestLogID:n,url:t.url,status:t.status,body:i,durationMs:Date.now()-a})),i}function Os(r,e){return!r||typeof r!="object"||Array.isArray(r)?r:Object.defineProperty(r,"_request_id",{value:e.headers.get("request-id"),enumerable:!1})}var ve;class Ge extends Promise{constructor(e,t,s=$s){super(n=>{n(null)}),this.responsePromise=t,this.parseResponse=s,ve.set(this,void 0),m(this,ve,e)}_thenUnwrap(e){return new Ge(c(this,ve,"f"),this.responsePromise,async(t,s)=>Os(e(await this.parseResponse(t,s),s),s.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(c(this,ve,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}ve=new WeakMap;var Te;class fn{constructor(e,t,s,n){Te.set(this,void 0),m(this,Te,e),this.options=n,this.response=t,this.body=s}hasNextPage(){return this.getPaginatedItems().length?this.nextPageRequestOptions()!=null:!1}async getNextPage(){const e=this.nextPageRequestOptions();if(!e)throw new y("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await c(this,Te,"f").requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Te=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class gn extends Ge{constructor(e,t,s){super(e,t,async(n,a)=>new s(n,a.response,await $s(n,a),a.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}class Ee extends fn{constructor(e,t,s,n){super(e,t,s,n),this.data=s.data||[],this.has_more=s.has_more||!1,this.first_id=s.first_id||null,this.last_id=s.last_id||null}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){var t;if((t=this.options.query)!=null&&t.before_id){const s=this.first_id;return s?{...this.options,query:{...Ut(this.options.query),before_id:s}}:null}const e=this.last_id;return e?{...this.options,query:{...Ut(this.options.query),after_id:e}}:null}}const Ls=()=>{var r;if(typeof File>"u"){const{process:e}=globalThis,t=typeof((r=e==null?void 0:e.versions)==null?void 0:r.node)=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function oe(r,e,t){return Ls(),new File(r,e??"unknown_file",t)}function Je(r){return(typeof r=="object"&&r!==null&&("name"in r&&r.name&&String(r.name)||"url"in r&&r.url&&String(r.url)||"filename"in r&&r.filename&&String(r.filename)||"path"in r&&r.path&&String(r.path))||"").split(/[\\/]/).pop()||void 0}const js=r=>r!=null&&typeof r=="object"&&typeof r[Symbol.asyncIterator]=="function",mn=async(r,e)=>({...r,body:await _n(r.body,e)}),Vt=new WeakMap;function pn(r){const e=typeof r=="function"?r:r.fetch,t=Vt.get(e);if(t)return t;const s=(async()=>{try{const n="Response"in e?e.Response:(await e("data:,")).constructor,a=new FormData;return a.toString()!==await new n(a).text()}catch{return!0}})();return Vt.set(e,s),s}const _n=async(r,e)=>{if(!await pn(e))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");const t=new FormData;return await Promise.all(Object.entries(r||{}).map(([s,n])=>bt(t,s,n))),t},yn=r=>r instanceof Blob&&"name"in r,bt=async(r,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")r.append(e,String(t));else if(t instanceof Response){let s={};const n=t.headers.get("Content-Type");n&&(s={type:n}),r.append(e,oe([await t.blob()],Je(t),s))}else if(js(t))r.append(e,oe([await new Response(Ns(t)).blob()],Je(t)));else if(yn(t))r.append(e,oe([t],Je(t),{type:t.type}));else if(Array.isArray(t))await Promise.all(t.map(s=>bt(r,e+"[]",s)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([s,n])=>bt(r,`${e}[${s}]`,n)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}},qs=r=>r!=null&&typeof r=="object"&&typeof r.size=="number"&&typeof r.type=="string"&&typeof r.text=="function"&&typeof r.slice=="function"&&typeof r.arrayBuffer=="function",wn=r=>r!=null&&typeof r=="object"&&typeof r.name=="string"&&typeof r.lastModified=="number"&&qs(r),bn=r=>r!=null&&typeof r=="object"&&typeof r.url=="string"&&typeof r.blob=="function";async function Sn(r,e,t){if(Ls(),r=await r,e||(e=Je(r)),wn(r))return r instanceof File&&e==null&&t==null?r:oe([await r.arrayBuffer()],e??r.name,{type:r.type,lastModified:r.lastModified,...t});if(bn(r)){const n=await r.blob();return e||(e=new URL(r.url).pathname.split(/[\\/]/).pop()),oe(await St(n),e,t)}const s=await St(r);if(!(t!=null&&t.type)){const n=s.find(a=>typeof a=="object"&&"type"in a&&a.type);typeof n=="string"&&(t={...t,type:n})}return oe(s,e,t)}async function St(r){var t;let e=[];if(typeof r=="string"||ArrayBuffer.isView(r)||r instanceof ArrayBuffer)e.push(r);else if(qs(r))e.push(r instanceof Blob?r:await r.arrayBuffer());else if(js(r))for await(const s of r)e.push(...await St(s));else{const s=(t=r==null?void 0:r.constructor)==null?void 0:t.name;throw new Error(`Unexpected data type: ${typeof r}${s?`; constructor: ${s}`:""}${vn(r)}`)}return e}function vn(r){return typeof r!="object"||r===null?"":`; props: [${Object.getOwnPropertyNames(r).map(t=>`"${t}"`).join(", ")}]`}class J{constructor(e){this._client=e}}const Bs=Symbol.for("brand.privateNullableHeaders"),Kt=Array.isArray;function*kn(r){if(!r)return;if(Bs in r){const{values:s,nulls:n}=r;yield*s.entries();for(const a of n)yield[a,null];return}let e=!1,t;r instanceof Headers?t=r.entries():Kt(r)?t=r:(e=!0,t=Object.entries(r??{}));for(let s of t){const n=s[0];if(typeof n!="string")throw new TypeError("expected header name to be a string");const a=Kt(s[1])?s[1]:[s[1]];let i=!1;for(const o of a)o!==void 0&&(e&&!i&&(i=!0,yield[n,null]),yield[n,o])}}const b=r=>{const e=new Headers,t=new Set;for(const s of r){const n=new Set;for(const[a,i]of kn(s)){const o=a.toLowerCase();n.has(o)||(e.delete(a),n.add(o)),i===null?(e.delete(a),t.add(o)):(e.append(a,i),t.delete(o))}}return{[Bs]:!0,values:e,nulls:t}};function Us(r){return r.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const Mn=(r=Us)=>function(t,...s){if(t.length===1)return t[0];let n=!1;const a=t.reduce((u,d,p)=>(/[?#]/.test(d)&&(n=!0),u+d+(p===s.length?"":(n?encodeURIComponent:r)(String(s[p])))),""),i=a.split(/[?#]/,1)[0],o=[],l=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let f;for(;(f=l.exec(i))!==null;)o.push({start:f.index,length:f[0].length});if(o.length>0){let u=0;const d=o.reduce((p,h)=>{const w=" ".repeat(h.start-u),R="^".repeat(h.length);return u=h.start+h.length,p+w+R},"");throw new y(`Path parameters result in path with invalid segments:
${a}
${d}`)}return a},B=Mn(Us);class Ds extends J{list(e={},t){const{betas:s,...n}=e??{};return this._client.getAPIList("/v1/files",Ee,{query:n,...t,headers:b([{"anthropic-beta":[...s??[],"files-api-2025-04-14"].toString()},t==null?void 0:t.headers])})}delete(e,t={},s){const{betas:n}=t??{};return this._client.delete(B`/v1/files/${e}`,{...s,headers:b([{"anthropic-beta":[...n??[],"files-api-2025-04-14"].toString()},s==null?void 0:s.headers])})}download(e,t={},s){const{betas:n}=t??{};return this._client.get(B`/v1/files/${e}/content`,{...s,headers:b([{"anthropic-beta":[...n??[],"files-api-2025-04-14"].toString(),Accept:"application/binary"},s==null?void 0:s.headers]),__binaryResponse:!0})}retrieveMetadata(e,t={},s){const{betas:n}=t??{};return this._client.get(B`/v1/files/${e}`,{...s,headers:b([{"anthropic-beta":[...n??[],"files-api-2025-04-14"].toString()},s==null?void 0:s.headers])})}upload(e,t){const{betas:s,...n}=e;return this._client.post("/v1/files",mn({body:n,...t,headers:b([{"anthropic-beta":[...s??[],"files-api-2025-04-14"].toString()},t==null?void 0:t.headers])},this._client))}}let Fs=class extends J{retrieve(e,t={},s){const{betas:n}=t??{};return this._client.get(B`/v1/models/${e}?beta=true`,{...s,headers:b([{...(n==null?void 0:n.toString())!=null?{"anthropic-beta":n==null?void 0:n.toString()}:void 0},s==null?void 0:s.headers])})}list(e={},t){const{betas:s,...n}=e??{};return this._client.getAPIList("/v1/models?beta=true",Ee,{query:n,...t,headers:b([{...(s==null?void 0:s.toString())!=null?{"anthropic-beta":s==null?void 0:s.toString()}:void 0},t==null?void 0:t.headers])})}};class Ze{constructor(e,t){this.iterator=e,this.controller=t}async*decoder(){const e=new Re;for await(const t of this.iterator)for(const s of e.decode(t))yield JSON.parse(s);for(const t of e.flush())yield JSON.parse(t)}[Symbol.asyncIterator](){return this.decoder()}static fromResponse(e,t){if(!e.body)throw t.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new y("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new y("Attempted to iterate over a response with no body");return new Ze(kt(e.body),t)}}let Ws=class extends J{create(e,t){const{betas:s,...n}=e;return this._client.post("/v1/messages/batches?beta=true",{body:n,...t,headers:b([{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString()},t==null?void 0:t.headers])})}retrieve(e,t={},s){const{betas:n}=t??{};return this._client.get(B`/v1/messages/batches/${e}?beta=true`,{...s,headers:b([{"anthropic-beta":[...n??[],"message-batches-2024-09-24"].toString()},s==null?void 0:s.headers])})}list(e={},t){const{betas:s,...n}=e??{};return this._client.getAPIList("/v1/messages/batches?beta=true",Ee,{query:n,...t,headers:b([{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString()},t==null?void 0:t.headers])})}delete(e,t={},s){const{betas:n}=t??{};return this._client.delete(B`/v1/messages/batches/${e}?beta=true`,{...s,headers:b([{"anthropic-beta":[...n??[],"message-batches-2024-09-24"].toString()},s==null?void 0:s.headers])})}cancel(e,t={},s){const{betas:n}=t??{};return this._client.post(B`/v1/messages/batches/${e}/cancel?beta=true`,{...s,headers:b([{"anthropic-beta":[...n??[],"message-batches-2024-09-24"].toString()},s==null?void 0:s.headers])})}async results(e,t={},s){const n=await this.retrieve(e);if(!n.results_url)throw new y(`No batch \`results_url\`; Has it finished processing? ${n.processing_status} - ${n.id}`);const{betas:a}=t??{};return this._client.get(n.results_url,{...s,headers:b([{"anthropic-beta":[...a??[],"message-batches-2024-09-24"].toString(),Accept:"application/binary"},s==null?void 0:s.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap((i,o)=>Ze.fromResponse(o.response,o.controller))}};const xn=r=>{let e=0,t=[];for(;e<r.length;){let s=r[e];if(s==="\\"){e++;continue}if(s==="{"){t.push({type:"brace",value:"{"}),e++;continue}if(s==="}"){t.push({type:"brace",value:"}"}),e++;continue}if(s==="["){t.push({type:"paren",value:"["}),e++;continue}if(s==="]"){t.push({type:"paren",value:"]"}),e++;continue}if(s===":"){t.push({type:"separator",value:":"}),e++;continue}if(s===","){t.push({type:"delimiter",value:","}),e++;continue}if(s==='"'){let o="",l=!1;for(s=r[++e];s!=='"';){if(e===r.length){l=!0;break}if(s==="\\"){if(e++,e===r.length){l=!0;break}o+=s+r[e],s=r[++e]}else o+=s,s=r[++e]}s=r[++e],l||t.push({type:"string",value:o});continue}if(s&&/\s/.test(s)){e++;continue}let a=/[0-9]/;if(s&&a.test(s)||s==="-"||s==="."){let o="";for(s==="-"&&(o+=s,s=r[++e]);s&&a.test(s)||s===".";)o+=s,s=r[++e];t.push({type:"number",value:o});continue}let i=/[a-z]/i;if(s&&i.test(s)){let o="";for(;s&&i.test(s)&&e!==r.length;)o+=s,s=r[++e];if(o=="true"||o=="false"||o==="null")t.push({type:"name",value:o});else{e++;continue}continue}e++}return t},ie=r=>{if(r.length===0)return r;let e=r[r.length-1];switch(e.type){case"separator":return r=r.slice(0,r.length-1),ie(r);case"number":let t=e.value[e.value.length-1];if(t==="."||t==="-")return r=r.slice(0,r.length-1),ie(r);case"string":let s=r[r.length-2];if((s==null?void 0:s.type)==="delimiter")return r=r.slice(0,r.length-1),ie(r);if((s==null?void 0:s.type)==="brace"&&s.value==="{")return r=r.slice(0,r.length-1),ie(r);break;case"delimiter":return r=r.slice(0,r.length-1),ie(r)}return r},Rn=r=>{let e=[];return r.map(t=>{t.type==="brace"&&(t.value==="{"?e.push("}"):e.splice(e.lastIndexOf("}"),1)),t.type==="paren"&&(t.value==="["?e.push("]"):e.splice(e.lastIndexOf("]"),1))}),e.length>0&&e.reverse().map(t=>{t==="}"?r.push({type:"brace",value:"}"}):t==="]"&&r.push({type:"paren",value:"]"})}),r},En=r=>{let e="";return r.map(t=>{switch(t.type){case"string":e+='"'+t.value+'"';break;default:e+=t.value;break}}),e},Cs=r=>JSON.parse(En(Rn(ie(xn(r)))));var N,V,he,Ie,de,fe,Ne,ge,W,me,$e,Oe,re,Le,je,ot,Qt,ct,lt,ut,ht,Yt;const Gt="__json_buf";function Zt(r){return r.type==="tool_use"||r.type==="server_tool_use"||r.type==="mcp_tool_use"}class Ke{constructor(){N.add(this),this.messages=[],this.receivedMessages=[],V.set(this,void 0),this.controller=new AbortController,he.set(this,void 0),Ie.set(this,()=>{}),de.set(this,()=>{}),fe.set(this,void 0),Ne.set(this,()=>{}),ge.set(this,()=>{}),W.set(this,{}),me.set(this,!1),$e.set(this,!1),Oe.set(this,!1),re.set(this,!1),Le.set(this,void 0),je.set(this,void 0),ct.set(this,e=>{if(m(this,$e,!0),xe(e)&&(e=new q),e instanceof q)return m(this,Oe,!0),this._emit("abort",e);if(e instanceof y)return this._emit("error",e);if(e instanceof Error){const t=new y(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new y(String(e)))}),m(this,he,new Promise((e,t)=>{m(this,Ie,e,"f"),m(this,de,t,"f")})),m(this,fe,new Promise((e,t)=>{m(this,Ne,e,"f"),m(this,ge,t,"f")})),c(this,he,"f").catch(()=>{}),c(this,fe,"f").catch(()=>{})}get response(){return c(this,Le,"f")}get request_id(){return c(this,je,"f")}async withResponse(){const e=await c(this,he,"f");if(!e)throw new Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){const t=new Ke;return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,s){const n=new Ke;for(const a of t.messages)n._addMessageParam(a);return n._run(()=>n._createMessage(e,{...t,stream:!0},{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),n}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},c(this,ct,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,s){var o;const n=s==null?void 0:s.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),c(this,N,"m",lt).call(this);const{response:a,data:i}=await e.create({...t,stream:!0},{...s,signal:this.controller.signal}).withResponse();this._connected(a);for await(const l of i)c(this,N,"m",ut).call(this,l);if((o=i.controller.signal)!=null&&o.aborted)throw new q;c(this,N,"m",ht).call(this)}_connected(e){this.ended||(m(this,Le,e),m(this,je,e==null?void 0:e.headers.get("request-id")),c(this,Ie,"f").call(this,e),this._emit("connect"))}get ended(){return c(this,me,"f")}get errored(){return c(this,$e,"f")}get aborted(){return c(this,Oe,"f")}abort(){this.controller.abort()}on(e,t){return(c(this,W,"f")[e]||(c(this,W,"f")[e]=[])).push({listener:t}),this}off(e,t){const s=c(this,W,"f")[e];if(!s)return this;const n=s.findIndex(a=>a.listener===t);return n>=0&&s.splice(n,1),this}once(e,t){return(c(this,W,"f")[e]||(c(this,W,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,s)=>{m(this,re,!0),e!=="error"&&this.once("error",s),this.once(e,t)})}async done(){m(this,re,!0),await c(this,fe,"f")}get currentMessage(){return c(this,V,"f")}async finalMessage(){return await this.done(),c(this,N,"m",ot).call(this)}async finalText(){return await this.done(),c(this,N,"m",Qt).call(this)}_emit(e,...t){if(c(this,me,"f"))return;e==="end"&&(m(this,me,!0),c(this,Ne,"f").call(this));const s=c(this,W,"f")[e];if(s&&(c(this,W,"f")[e]=s.filter(n=>!n.once),s.forEach(({listener:n})=>n(...t))),e==="abort"){const n=t[0];!c(this,re,"f")&&!(s!=null&&s.length)&&Promise.reject(n),c(this,de,"f").call(this,n),c(this,ge,"f").call(this,n),this._emit("end");return}if(e==="error"){const n=t[0];!c(this,re,"f")&&!(s!=null&&s.length)&&Promise.reject(n),c(this,de,"f").call(this,n),c(this,ge,"f").call(this,n),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",c(this,N,"m",ot).call(this))}async _fromReadableStream(e,t){var a;const s=t==null?void 0:t.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),c(this,N,"m",lt).call(this),this._connected(null);const n=U.fromReadableStream(e,this.controller);for await(const i of n)c(this,N,"m",ut).call(this,i);if((a=n.controller.signal)!=null&&a.aborted)throw new q;c(this,N,"m",ht).call(this)}[(V=new WeakMap,he=new WeakMap,Ie=new WeakMap,de=new WeakMap,fe=new WeakMap,Ne=new WeakMap,ge=new WeakMap,W=new WeakMap,me=new WeakMap,$e=new WeakMap,Oe=new WeakMap,re=new WeakMap,Le=new WeakMap,je=new WeakMap,ct=new WeakMap,N=new WeakSet,ot=function(){if(this.receivedMessages.length===0)throw new y("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},Qt=function(){if(this.receivedMessages.length===0)throw new y("stream ended without producing a Message with role=assistant");const t=this.receivedMessages.at(-1).content.filter(s=>s.type==="text").map(s=>s.text);if(t.length===0)throw new y("stream ended without producing a content block with type=text");return t.join(" ")},lt=function(){this.ended||m(this,V,void 0)},ut=function(t){if(this.ended)return;const s=c(this,N,"m",Yt).call(this,t);switch(this._emit("streamEvent",t,s),t.type){case"content_block_delta":{const n=s.content.at(-1);switch(t.delta.type){case"text_delta":{n.type==="text"&&this._emit("text",t.delta.text,n.text||"");break}case"citations_delta":{n.type==="text"&&this._emit("citation",t.delta.citation,n.citations??[]);break}case"input_json_delta":{Zt(n)&&n.input&&this._emit("inputJson",t.delta.partial_json,n.input);break}case"thinking_delta":{n.type==="thinking"&&this._emit("thinking",t.delta.thinking,n.thinking);break}case"signature_delta":{n.type==="thinking"&&this._emit("signature",n.signature);break}default:t.delta}break}case"message_stop":{this._addMessageParam(s),this._addMessage(s,!0);break}case"content_block_stop":{this._emit("contentBlock",s.content.at(-1));break}case"message_start":{m(this,V,s);break}}},ht=function(){if(this.ended)throw new y("stream has ended, this shouldn't happen");const t=c(this,V,"f");if(!t)throw new y("request ended without sending any chunks");return m(this,V,void 0),t},Yt=function(t){let s=c(this,V,"f");if(t.type==="message_start"){if(s)throw new y(`Unexpected event order, got ${t.type} before receiving "message_stop"`);return t.message}if(!s)throw new y(`Unexpected event order, got ${t.type} before "message_start"`);switch(t.type){case"message_stop":return s;case"message_delta":return s.container=t.delta.container,s.stop_reason=t.delta.stop_reason,s.stop_sequence=t.delta.stop_sequence,s.usage.output_tokens=t.usage.output_tokens,t.usage.input_tokens!=null&&(s.usage.input_tokens=t.usage.input_tokens),t.usage.cache_creation_input_tokens!=null&&(s.usage.cache_creation_input_tokens=t.usage.cache_creation_input_tokens),t.usage.cache_read_input_tokens!=null&&(s.usage.cache_read_input_tokens=t.usage.cache_read_input_tokens),t.usage.server_tool_use!=null&&(s.usage.server_tool_use=t.usage.server_tool_use),s;case"content_block_start":return s.content.push(t.content_block),s;case"content_block_delta":{const n=s.content.at(t.index);switch(t.delta.type){case"text_delta":{(n==null?void 0:n.type)==="text"&&(n.text+=t.delta.text);break}case"citations_delta":{(n==null?void 0:n.type)==="text"&&(n.citations??(n.citations=[]),n.citations.push(t.delta.citation));break}case"input_json_delta":{if(n&&Zt(n)){let a=n[Gt]||"";a+=t.delta.partial_json,Object.defineProperty(n,Gt,{value:a,enumerable:!1,writable:!0}),a&&(n.input=Cs(a))}break}case"thinking_delta":{(n==null?void 0:n.type)==="thinking"&&(n.thinking+=t.delta.thinking);break}case"signature_delta":{(n==null?void 0:n.type)==="thinking"&&(n.signature=t.delta.signature);break}default:t.delta}return s}case"content_block_stop":return s}},Symbol.asyncIterator)](){const e=[],t=[];let s=!1;return this.on("streamEvent",n=>{const a=t.shift();a?a.resolve(n):e.push(n)}),this.on("end",()=>{s=!0;for(const n of t)n.resolve(void 0);t.length=0}),this.on("abort",n=>{s=!0;for(const a of t)a.reject(n);t.length=0}),this.on("error",n=>{s=!0;for(const a of t)a.reject(n);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new U(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}const Hs={"claude-opus-4-20250514":8192,"claude-opus-4-0":8192,"claude-4-opus-20250514":8192,"anthropic.claude-opus-4-20250514-v1:0":8192,"claude-opus-4@20250514":8192},es={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025"};let xt=class extends J{constructor(){super(...arguments),this.batches=new Ws(this._client)}create(e,t){const{betas:s,...n}=e;n.model in es&&console.warn(`The model '${n.model}' is deprecated and will reach end-of-life on ${es[n.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`);let a=this._client._options.timeout;if(!n.stream&&a==null){const i=Hs[n.model]??void 0;a=this._client.calculateNonstreamingTimeout(n.max_tokens,i)}return this._client.post("/v1/messages?beta=true",{body:n,timeout:a??6e5,...t,headers:b([{...(s==null?void 0:s.toString())!=null?{"anthropic-beta":s==null?void 0:s.toString()}:void 0},t==null?void 0:t.headers]),stream:e.stream??!1})}stream(e,t){return Ke.createMessage(this,e,t)}countTokens(e,t){const{betas:s,...n}=e;return this._client.post("/v1/messages/count_tokens?beta=true",{body:n,...t,headers:b([{"anthropic-beta":[...s??[],"token-counting-2024-11-01"].toString()},t==null?void 0:t.headers])})}};xt.Batches=Ws;class Pe extends J{constructor(){super(...arguments),this.models=new Fs(this._client),this.messages=new xt(this._client),this.files=new Ds(this._client)}}Pe.Models=Fs;Pe.Messages=xt;Pe.Files=Ds;class Xs extends J{create(e,t){const{betas:s,...n}=e;return this._client.post("/v1/complete",{body:n,timeout:this._client._options.timeout??6e5,...t,headers:b([{...(s==null?void 0:s.toString())!=null?{"anthropic-beta":s==null?void 0:s.toString()}:void 0},t==null?void 0:t.headers]),stream:e.stream??!1})}}var $,K,pe,qe,_e,ye,Be,we,C,be,Ue,De,ne,Fe,We,dt,ts,ft,gt,mt,pt,ss;const rs="__json_buf";function ns(r){return r.type==="tool_use"||r.type==="server_tool_use"}class Qe{constructor(){$.add(this),this.messages=[],this.receivedMessages=[],K.set(this,void 0),this.controller=new AbortController,pe.set(this,void 0),qe.set(this,()=>{}),_e.set(this,()=>{}),ye.set(this,void 0),Be.set(this,()=>{}),we.set(this,()=>{}),C.set(this,{}),be.set(this,!1),Ue.set(this,!1),De.set(this,!1),ne.set(this,!1),Fe.set(this,void 0),We.set(this,void 0),ft.set(this,e=>{if(m(this,Ue,!0),xe(e)&&(e=new q),e instanceof q)return m(this,De,!0),this._emit("abort",e);if(e instanceof y)return this._emit("error",e);if(e instanceof Error){const t=new y(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new y(String(e)))}),m(this,pe,new Promise((e,t)=>{m(this,qe,e,"f"),m(this,_e,t,"f")})),m(this,ye,new Promise((e,t)=>{m(this,Be,e,"f"),m(this,we,t,"f")})),c(this,pe,"f").catch(()=>{}),c(this,ye,"f").catch(()=>{})}get response(){return c(this,Fe,"f")}get request_id(){return c(this,We,"f")}async withResponse(){const e=await c(this,pe,"f");if(!e)throw new Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){const t=new Qe;return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,s){const n=new Qe;for(const a of t.messages)n._addMessageParam(a);return n._run(()=>n._createMessage(e,{...t,stream:!0},{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),n}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},c(this,ft,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,s){var o;const n=s==null?void 0:s.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),c(this,$,"m",gt).call(this);const{response:a,data:i}=await e.create({...t,stream:!0},{...s,signal:this.controller.signal}).withResponse();this._connected(a);for await(const l of i)c(this,$,"m",mt).call(this,l);if((o=i.controller.signal)!=null&&o.aborted)throw new q;c(this,$,"m",pt).call(this)}_connected(e){this.ended||(m(this,Fe,e),m(this,We,e==null?void 0:e.headers.get("request-id")),c(this,qe,"f").call(this,e),this._emit("connect"))}get ended(){return c(this,be,"f")}get errored(){return c(this,Ue,"f")}get aborted(){return c(this,De,"f")}abort(){this.controller.abort()}on(e,t){return(c(this,C,"f")[e]||(c(this,C,"f")[e]=[])).push({listener:t}),this}off(e,t){const s=c(this,C,"f")[e];if(!s)return this;const n=s.findIndex(a=>a.listener===t);return n>=0&&s.splice(n,1),this}once(e,t){return(c(this,C,"f")[e]||(c(this,C,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,s)=>{m(this,ne,!0),e!=="error"&&this.once("error",s),this.once(e,t)})}async done(){m(this,ne,!0),await c(this,ye,"f")}get currentMessage(){return c(this,K,"f")}async finalMessage(){return await this.done(),c(this,$,"m",dt).call(this)}async finalText(){return await this.done(),c(this,$,"m",ts).call(this)}_emit(e,...t){if(c(this,be,"f"))return;e==="end"&&(m(this,be,!0),c(this,Be,"f").call(this));const s=c(this,C,"f")[e];if(s&&(c(this,C,"f")[e]=s.filter(n=>!n.once),s.forEach(({listener:n})=>n(...t))),e==="abort"){const n=t[0];!c(this,ne,"f")&&!(s!=null&&s.length)&&Promise.reject(n),c(this,_e,"f").call(this,n),c(this,we,"f").call(this,n),this._emit("end");return}if(e==="error"){const n=t[0];!c(this,ne,"f")&&!(s!=null&&s.length)&&Promise.reject(n),c(this,_e,"f").call(this,n),c(this,we,"f").call(this,n),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",c(this,$,"m",dt).call(this))}async _fromReadableStream(e,t){var a;const s=t==null?void 0:t.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),c(this,$,"m",gt).call(this),this._connected(null);const n=U.fromReadableStream(e,this.controller);for await(const i of n)c(this,$,"m",mt).call(this,i);if((a=n.controller.signal)!=null&&a.aborted)throw new q;c(this,$,"m",pt).call(this)}[(K=new WeakMap,pe=new WeakMap,qe=new WeakMap,_e=new WeakMap,ye=new WeakMap,Be=new WeakMap,we=new WeakMap,C=new WeakMap,be=new WeakMap,Ue=new WeakMap,De=new WeakMap,ne=new WeakMap,Fe=new WeakMap,We=new WeakMap,ft=new WeakMap,$=new WeakSet,dt=function(){if(this.receivedMessages.length===0)throw new y("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},ts=function(){if(this.receivedMessages.length===0)throw new y("stream ended without producing a Message with role=assistant");const t=this.receivedMessages.at(-1).content.filter(s=>s.type==="text").map(s=>s.text);if(t.length===0)throw new y("stream ended without producing a content block with type=text");return t.join(" ")},gt=function(){this.ended||m(this,K,void 0)},mt=function(t){if(this.ended)return;const s=c(this,$,"m",ss).call(this,t);switch(this._emit("streamEvent",t,s),t.type){case"content_block_delta":{const n=s.content.at(-1);switch(t.delta.type){case"text_delta":{n.type==="text"&&this._emit("text",t.delta.text,n.text||"");break}case"citations_delta":{n.type==="text"&&this._emit("citation",t.delta.citation,n.citations??[]);break}case"input_json_delta":{ns(n)&&n.input&&this._emit("inputJson",t.delta.partial_json,n.input);break}case"thinking_delta":{n.type==="thinking"&&this._emit("thinking",t.delta.thinking,n.thinking);break}case"signature_delta":{n.type==="thinking"&&this._emit("signature",n.signature);break}default:t.delta}break}case"message_stop":{this._addMessageParam(s),this._addMessage(s,!0);break}case"content_block_stop":{this._emit("contentBlock",s.content.at(-1));break}case"message_start":{m(this,K,s);break}}},pt=function(){if(this.ended)throw new y("stream has ended, this shouldn't happen");const t=c(this,K,"f");if(!t)throw new y("request ended without sending any chunks");return m(this,K,void 0),t},ss=function(t){let s=c(this,K,"f");if(t.type==="message_start"){if(s)throw new y(`Unexpected event order, got ${t.type} before receiving "message_stop"`);return t.message}if(!s)throw new y(`Unexpected event order, got ${t.type} before "message_start"`);switch(t.type){case"message_stop":return s;case"message_delta":return s.stop_reason=t.delta.stop_reason,s.stop_sequence=t.delta.stop_sequence,s.usage.output_tokens=t.usage.output_tokens,t.usage.input_tokens!=null&&(s.usage.input_tokens=t.usage.input_tokens),t.usage.cache_creation_input_tokens!=null&&(s.usage.cache_creation_input_tokens=t.usage.cache_creation_input_tokens),t.usage.cache_read_input_tokens!=null&&(s.usage.cache_read_input_tokens=t.usage.cache_read_input_tokens),t.usage.server_tool_use!=null&&(s.usage.server_tool_use=t.usage.server_tool_use),s;case"content_block_start":return s.content.push(t.content_block),s;case"content_block_delta":{const n=s.content.at(t.index);switch(t.delta.type){case"text_delta":{(n==null?void 0:n.type)==="text"&&(n.text+=t.delta.text);break}case"citations_delta":{(n==null?void 0:n.type)==="text"&&(n.citations??(n.citations=[]),n.citations.push(t.delta.citation));break}case"input_json_delta":{if(n&&ns(n)){let a=n[rs]||"";a+=t.delta.partial_json,Object.defineProperty(n,rs,{value:a,enumerable:!1,writable:!0}),a&&(n.input=Cs(a))}break}case"thinking_delta":{(n==null?void 0:n.type)==="thinking"&&(n.thinking+=t.delta.thinking);break}case"signature_delta":{(n==null?void 0:n.type)==="thinking"&&(n.signature=t.delta.signature);break}default:t.delta}return s}case"content_block_stop":return s}},Symbol.asyncIterator)](){const e=[],t=[];let s=!1;return this.on("streamEvent",n=>{const a=t.shift();a?a.resolve(n):e.push(n)}),this.on("end",()=>{s=!0;for(const n of t)n.resolve(void 0);t.length=0}),this.on("abort",n=>{s=!0;for(const a of t)a.reject(n);t.length=0}),this.on("error",n=>{s=!0;for(const a of t)a.reject(n);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new U(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}class Js extends J{create(e,t){return this._client.post("/v1/messages/batches",{body:e,...t})}retrieve(e,t){return this._client.get(B`/v1/messages/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/v1/messages/batches",Ee,{query:e,...t})}delete(e,t){return this._client.delete(B`/v1/messages/batches/${e}`,t)}cancel(e,t){return this._client.post(B`/v1/messages/batches/${e}/cancel`,t)}async results(e,t){const s=await this.retrieve(e);if(!s.results_url)throw new y(`No batch \`results_url\`; Has it finished processing? ${s.processing_status} - ${s.id}`);return this._client.get(s.results_url,{...t,headers:b([{Accept:"application/binary"},t==null?void 0:t.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap((n,a)=>Ze.fromResponse(a.response,a.controller))}}class Rt extends J{constructor(){super(...arguments),this.batches=new Js(this._client)}create(e,t){e.model in as&&console.warn(`The model '${e.model}' is deprecated and will reach end-of-life on ${as[e.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`);let s=this._client._options.timeout;if(!e.stream&&s==null){const n=Hs[e.model]??void 0;s=this._client.calculateNonstreamingTimeout(e.max_tokens,n)}return this._client.post("/v1/messages",{body:e,timeout:s??6e5,...t,stream:e.stream??!1})}stream(e,t){return Qe.createMessage(this,e,t)}countTokens(e,t){return this._client.post("/v1/messages/count_tokens",{body:e,...t})}}const as={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025"};Rt.Batches=Js;class zs extends J{retrieve(e,t={},s){const{betas:n}=t??{};return this._client.get(B`/v1/models/${e}`,{...s,headers:b([{...(n==null?void 0:n.toString())!=null?{"anthropic-beta":n==null?void 0:n.toString()}:void 0},s==null?void 0:s.headers])})}list(e={},t){const{betas:s,...n}=e??{};return this._client.getAPIList("/v1/models",Ee,{query:n,...t,headers:b([{...(s==null?void 0:s.toString())!=null?{"anthropic-beta":s==null?void 0:s.toString()}:void 0},t==null?void 0:t.headers])})}}var _t={};const Ce=r=>{var e,t,s,n;if(typeof globalThis.process<"u")return((e=_t==null?void 0:_t[r])==null?void 0:e.trim())??void 0;if(typeof globalThis.Deno<"u")return(n=(s=(t=globalThis.Deno.env)==null?void 0:t.get)==null?void 0:s.call(t,r))==null?void 0:n.trim()};var Vs,ze;class x{constructor({baseURL:e=Ce("ANTHROPIC_BASE_URL"),apiKey:t=Ce("ANTHROPIC_API_KEY")??null,authToken:s=Ce("ANTHROPIC_AUTH_TOKEN")??null,...n}={}){ze.set(this,void 0);const a={apiKey:t,authToken:s,...n,baseURL:e||"https://api.anthropic.com"};if(!a.dangerouslyAllowBrowser&&Yr())throw new y(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new Anthropic({ apiKey, dangerouslyAllowBrowser: true });
`);this.baseURL=a.baseURL,this.timeout=a.timeout??se.DEFAULT_TIMEOUT,this.logger=a.logger??console;const i="warn";this.logLevel=i,this.logLevel=Dt(a.logLevel,"ClientOptions.logLevel",this)??Dt(Ce("ANTHROPIC_LOG"),"process.env['ANTHROPIC_LOG']",this)??i,this.fetchOptions=a.fetchOptions,this.maxRetries=a.maxRetries??2,this.fetch=a.fetch??sn(),m(this,ze,nn),this._options=a,this.apiKey=t,this.authToken=s}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetchOptions:this.fetchOptions,apiKey:this.apiKey,authToken:this.authToken,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){if(!(this.apiKey&&e.get("x-api-key"))&&!t.has("x-api-key")&&!(this.authToken&&e.get("authorization"))&&!t.has("authorization"))throw new Error('Could not resolve authentication method. Expected either apiKey or authToken to be set. Or for one of the "X-Api-Key" or "Authorization" headers to be explicitly omitted')}authHeaders(e){return b([this.apiKeyAuth(e),this.bearerAuth(e)])}apiKeyAuth(e){if(this.apiKey!=null)return b([{"X-Api-Key":this.apiKey}])}bearerAuth(e){if(this.authToken!=null)return b([{Authorization:`Bearer ${this.authToken}`}])}stringifyQuery(e){return Object.entries(e).filter(([t,s])=>typeof s<"u").map(([t,s])=>{if(typeof s=="string"||typeof s=="number"||typeof s=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(s)}`;if(s===null)return`${encodeURIComponent(t)}=`;throw new y(`Cannot stringify type ${typeof s}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${ae}`}defaultIdempotencyKey(){return`stainless-node-retry-${bs()}`}makeStatusError(e,t,s,n){return E.generate(e,t,s,n)}buildURL(e,t){const s=Xr(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),n=this.defaultQuery();return Jr(n)||(t={...n,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(s.search=this.stringifyQuery(t)),s.toString()}_calculateNonstreamingTimeout(e){if(3600*e/128e3>600)throw new y("Streaming is strongly recommended for operations that may take longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-typescript#streaming-responses for more details");return 600*1e3}async prepareOptions(e){}async prepareRequest(e,{url:t,options:s}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,s){return this.request(Promise.resolve(s).then(n=>({method:e,path:t,...n})))}request(e,t=null){return new Ge(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,s){var g,v;const n=await e,a=n.maxRetries??this.maxRetries;t==null&&(t=a),await this.prepareOptions(n);const{req:i,url:o,timeout:l}=this.buildRequest(n,{retryCount:a-t});await this.prepareRequest(i,{url:o,options:n});const f="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),u=s===void 0?"":`, retryOf: ${s}`,d=Date.now();if(P(this).debug(`[${f}] sending request`,Z({retryOfRequestLogID:s,method:n.method,url:o,options:n,headers:i.headers})),(g=n.signal)!=null&&g.aborted)throw new q;const p=new AbortController,h=await this.fetchWithTimeout(o,i,l,p).catch(wt),w=Date.now();if(h instanceof Error){const S=`retrying, ${t} attempts remaining`;if((v=n.signal)!=null&&v.aborted)throw new q;const k=xe(h)||/timed? ?out/i.test(String(h)+("cause"in h?String(h.cause):""));if(t)return P(this).info(`[${f}] connection ${k?"timed out":"failed"} - ${S}`),P(this).debug(`[${f}] connection ${k?"timed out":"failed"} (${S})`,Z({retryOfRequestLogID:s,url:o,durationMs:w-d,message:h.message})),this.retryRequest(n,t,s??f);throw P(this).info(`[${f}] connection ${k?"timed out":"failed"} - error; no more retries left`),P(this).debug(`[${f}] connection ${k?"timed out":"failed"} (error; no more retries left)`,Z({retryOfRequestLogID:s,url:o,durationMs:w-d,message:h.message})),k?new Ss:new Ye({cause:h})}const R=[...h.headers.entries()].filter(([S])=>S==="request-id").map(([S,k])=>", "+S+": "+JSON.stringify(k)).join(""),_=`[${f}${u}${R}] ${i.method} ${o} ${h.ok?"succeeded":"failed"} with status ${h.status} in ${w-d}ms`;if(!h.ok){const S=this.shouldRetry(h);if(t&&S){const F=`retrying, ${t} attempts remaining`;return await rn(h.body),P(this).info(`${_} - ${F}`),P(this).debug(`[${f}] response error (${F})`,Z({retryOfRequestLogID:s,url:h.url,status:h.status,headers:h.headers,durationMs:w-d})),this.retryRequest(n,t,s??f,h.headers)}const k=S?"error; no more retries left":"error; not retryable";P(this).info(`${_} - ${k}`);const A=await h.text().catch(F=>wt(F).message),G=Ts(A),D=G?void 0:A;throw P(this).debug(`[${f}] response error (${k})`,Z({retryOfRequestLogID:s,url:h.url,status:h.status,headers:h.headers,message:D,durationMs:Date.now()-d})),this.makeStatusError(h.status,G,D,h.headers)}return P(this).info(_),P(this).debug(`[${f}] response start`,Z({retryOfRequestLogID:s,url:h.url,status:h.status,headers:h.headers,durationMs:w-d})),{response:h,options:n,controller:p,requestLogID:f,retryOfRequestLogID:s,startTime:d}}getAPIList(e,t,s){return this.requestAPIList(t,{method:"get",path:e,...s})}requestAPIList(e,t){const s=this.makeRequest(t,null,void 0);return new gn(this,s,e)}async fetchWithTimeout(e,t,s,n){const{signal:a,method:i,...o}=t||{};a&&a.addEventListener("abort",()=>n.abort());const l=setTimeout(()=>n.abort(),s),f=globalThis.ReadableStream&&o.body instanceof globalThis.ReadableStream||typeof o.body=="object"&&o.body!==null&&Symbol.asyncIterator in o.body,u={signal:n.signal,...f?{duplex:"half"}:{},method:"GET",...o};i&&(u.method=i.toUpperCase());try{return await this.fetch.call(void 0,e,u)}finally{clearTimeout(l)}}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,s,n){let a;const i=n==null?void 0:n.get("retry-after-ms");if(i){const l=parseFloat(i);Number.isNaN(l)||(a=l)}const o=n==null?void 0:n.get("retry-after");if(o&&!a){const l=parseFloat(o);Number.isNaN(l)?a=Date.parse(o)-Date.now():a=l*1e3}if(!(a&&0<=a&&a<60*1e3)){const l=e.maxRetries??this.maxRetries;a=this.calculateDefaultRetryTimeoutMillis(t,l)}return await Kr(a),this.makeRequest(e,t-1,s)}calculateDefaultRetryTimeoutMillis(e,t){const a=t-e,i=Math.min(.5*Math.pow(2,a),8),o=1-Math.random()*.25;return i*o*1e3}calculateNonstreamingTimeout(e,t){if(36e5*e/128e3>6e5||t!=null&&e>t)throw new y("Streaming is strongly recommended for operations that may token longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-typescript#long-requests for more details");return 6e5}buildRequest(e,{retryCount:t=0}={}){const s={...e},{method:n,path:a,query:i}=s,o=this.buildURL(a,i);"timeout"in s&&Vr("timeout",s.timeout),s.timeout=s.timeout??this.timeout;const{bodyHeaders:l,body:f}=this.buildBody({options:s}),u=this.buildHeaders({options:e,method:n,bodyHeaders:l,retryCount:t});return{req:{method:n,headers:u,...s.signal&&{signal:s.signal},...globalThis.ReadableStream&&f instanceof globalThis.ReadableStream&&{duplex:"half"},...f&&{body:f},...this.fetchOptions??{},...s.fetchOptions??{}},url:o,timeout:s.timeout}}buildHeaders({options:e,method:t,bodyHeaders:s,retryCount:n}){let a={};this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);const i=b([a,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(n),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...tn(),...this._options.dangerouslyAllowBrowser?{"anthropic-dangerous-direct-browser-access":"true"}:void 0,"anthropic-version":"2023-06-01"},this.authHeaders(e),this._options.defaultHeaders,s,e.headers]);return this.validateHeaders(i),i.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};const s=b([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&s.values.has("content-type")||e instanceof Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:Ns(e)}:c(this,ze,"f").call(this,{body:e,headers:s})}}Vs=x,ze=new WeakMap;x.Anthropic=Vs;x.HUMAN_PROMPT=`

Human:`;x.AI_PROMPT=`

Assistant:`;x.DEFAULT_TIMEOUT=6e5;x.AnthropicError=y;x.APIError=E;x.APIConnectionError=Ye;x.APIConnectionTimeoutError=Ss;x.APIUserAbortError=q;x.NotFoundError=xs;x.ConflictError=Rs;x.RateLimitError=Ps;x.BadRequestError=vs;x.AuthenticationError=ks;x.InternalServerError=As;x.PermissionDeniedError=Ms;x.UnprocessableEntityError=Es;x.toFile=Sn;class se extends x{constructor(){super(...arguments),this.completions=new Xs(this),this.messages=new Rt(this),this.models=new zs(this),this.beta=new Pe(this)}}se.Completions=Xs;se.Messages=Rt;se.Models=zs;se.Beta=Pe;const{HUMAN_PROMPT:Kn,AI_PROMPT:Qn}=se;let Ks,ce=[];async function Pn(r,e){Ks=new se({apiKey:r,dangerouslyAllowBrowser:!0}),ce.push(e),Qs()}async function Qs(){try{let r=await Ks.messages.create({model:"claude-sonnet-4-20250514",max_tokens:512,temperature:1,system:Cr,messages:ce});ce.push({role:r.role,content:r.content}),vt.update(()=>ce)}catch(r){ws.update(e=>[`${r}`,...e])}}async function An(r){ce.push({content:r,role:"user"}),vt.update(()=>ce),await Qs()}function is(r){return typeof r.content=="string"?r.content:r.content.filter(e=>e.type==="text").map(e=>e.text).join("")}function Tn(r,e){const t=r.target;if(t.files&&t.files.length>0){const s=t.files[0];s.type.startsWith("image/")&&e(s)}}var In=(r,e)=>{var t;return(t=M(e))==null?void 0:t.click()},Nn=r=>r.stopPropagation(),$n=le('<button><div class="dropzone-content svelte-ej8liz"><div class="header svelte-ej8liz"><h1 class="svelte-ej8liz">ð®</h1> <h2 class="svelte-ej8liz">puma</h2> <p class="svelte-ej8liz">Drop an image here or click to select to begin chatting</p></div> <input type="password" placeholder="Enter your Anthropic API key" class="api-input"/> <input type="file" accept="image/*" style="display: none;"/></div></button>');function On(r,e){hs(e,!0);let t=ke(e,"hidden",15),s=ke(e,"blob",15),n=ee(!1),a=ee(void 0),i=ee("");function o(_){_.preventDefault(),L(n,!0)}function l(_){_.preventDefault(),L(n,!1)}function f(_){var v;_.preventDefault(),L(n,!1);const g=(v=_.dataTransfer)==null?void 0:v.files;if(g&&g.length>0){const S=g[0];S.type.startsWith("image/")&&u(S)}}function u(_){s(URL.createObjectURL(_));const g=new FileReader;g.onload=async v=>{var k;const S=(k=v.target)==null?void 0:k.result;await Pn(M(i),{role:"user",content:[{type:"image",source:{type:"base64",media_type:_.type,data:S.split(",")[1]}}]}),t(!0)},g.readAsDataURL(_)}var d=$n();let p;d.__click=[In,a];var h=H(d),w=te(H(h),2);_s(w),w.__click=[Nn];var R=te(w,2);R.__change=[Tn,u],$r(R,_=>L(a,_),()=>M(a)),X(h),X(d),Me(_=>p=ps(d,1,"dropzone svelte-ej8liz",null,p,_),[()=>({dragover:M(n)})]),He("dragover",d,o),He("dragleave",d,l),He("drop",d,f),ys(w,()=>M(i),_=>L(i,_)),Y(r,d),ds()}Nr(["click","change"]);var Ln=le('<div class="typing-indicator svelte-pky7o1"><span class="svelte-pky7o1"></span> <span class="svelte-pky7o1"></span> <span class="svelte-pky7o1"></span></div>'),jn=le('<div><div class="bubble svelte-pky7o1"><!></div></div>');function os(r,e){let t=ke(e,"is_user",3,!1),s=ke(e,"body",3,""),n=ke(e,"thinking",3,!1);var a=jn(),i=H(a),o=H(i);{var l=u=>{var d=tr();Me(()=>fs(d,s())),Y(u,d)},f=u=>{var d=Ln();Y(u,d)};Xe(o,u=>{n()?u(f,!1):u(l)})}X(i),X(a),Me(()=>ps(a,1,`message ${t()?"user":"assistant"}`,"svelte-pky7o1")),Y(r,a)}var qn=le('<section class="svelte-1wfd3kj"><strong class="svelte-1wfd3kj">Error!</strong> <p class="svelte-1wfd3kj"> </p></section>');function Bn(r,e){var t=qn(),s=te(H(t),2),n=H(s,!0);X(s),X(t),Me(()=>fs(n,e.body)),Y(r,t)}var Un=le('<img id="background" alt="background" class="svelte-soy5ar"/> <section class="container svelte-soy5ar"><!> <!></section> <div class="container svelte-soy5ar" id="chatbox"><form class="svelte-soy5ar"><input class="svelte-soy5ar"/> <button type="submit" class="svelte-soy5ar">Send</button></form></div>',1),Dn=le("<!> <!>",1);function Yn(r,e){hs(e,!0);const[t,s]=Or(),n=()=>$t(ws,"$errors",t),a=()=>$t(vt,"$history",t);let i=ee(!1),o=ee(""),l=ee(""),f=ee(!1);async function u(){if(M(l).length===0)return;L(f,!0);let _=M(l);L(l,""),await An(_),L(f,!1)}var d=Dn(),p=nt(d);Lt(p,1,n,Ot,(_,g)=>{Bn(_,{get body(){return M(g)}})});var h=te(p,2);{var w=_=>{On(_,{get hidden(){return M(i)},set hidden(g){L(i,g,!0)},get blob(){return M(o)},set blob(g){L(o,g,!0)}})},R=_=>{var g=Un(),v=nt(g),S=te(v,2),k=H(S);Lt(k,1,a,Ot,(O,et)=>{var Et=sr(),Ys=nt(Et);{var Gs=tt=>{const Zs=Nt(()=>M(et).role==="user"),er=Nt(()=>is(M(et)));os(tt,{get is_user(){return M(Zs)},get body(){return M(er)}})};Xe(Ys,tt=>{is(M(et))!==""&&tt(Gs)})}Y(O,Et)});var A=te(k,2);{var G=O=>{os(O,{thinking:!0})};Xe(A,O=>{(M(f)||a().length<2)&&O(G)})}X(S);var D=te(S,2),z=H(D),F=H(z);_s(F),Ar(2),X(z),X(D),Me(()=>yt(v,"src",M(o))),He("submit",z,O=>{O.preventDefault(),u()}),ys(F,()=>M(l),O=>L(l,O)),Y(_,g)};Xe(h,_=>{M(i)?_(R,!1):_(w)})}Y(r,d),ds(),s()}export{Yn as component};
